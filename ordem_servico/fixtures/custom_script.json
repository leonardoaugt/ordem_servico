[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2018-04-12 20:29:01.554527", 
  "name": "Customer-Client", 
  "script": "//Add Maintenance Visit Purpose to Customer Dashboard\n//frappe.ui.form.on(\"Customer\", {\n//    onload:  function(frm) {\n//        var div = $('[data-doctype=\"Quotation\"]').closest('div').parent();\n//\t  div.append('<div class=\"document-link\"><a href=\"#List/Maintenance Visit\" class=\"badge-link small\">Visita de //Manuten\u00e7\u00e3o</a></div>');\n//    }\n//});\n\nfrappe.ui.form.on(\"Customer\", {\n    validate: function(frm) {\n\n      var valida = '';\n\n      // Garante que o valor \u00e9 uma string\n      valor = frm.doc.tax_id.toString();\n\n      // Remove caracteres inv\u00e1lidos do valor\n      valor = valor.replace(/[^0-9]/g, '');\n\n      // Verifica CPF\n      if ( valor.length === 11 ) {\n         valida = 'CPF';\n      } \n  \n      // Verifica CNPJ\n      else if ( valor.length === 14 ) {\n         valida = 'CNPJ';\n      } \n     \n      if ( valida === 'CPF' ) {\n         var strCpf = valor;\n         var soma;\n         var resto;\n         soma = 0;\n         if (strCpf == \"00000000000\" ||\n             strCpf == \"11111111111\")\n                       {\n                       msgprint(strCpf, \"CPF invalido\");\n                       validated = false;\n                       }\n         else {\n         for (i = 1; i <= 9; i++) {\n             soma = soma + parseInt(strCpf.substring(i - 1, i)) * (11 - i);\n             }\n         resto = soma % 11;\n       \n         if (resto == 10 || resto == 11 || resto < 2) {\n             resto = 0;\n         } else {\n             resto = 11 - resto;\n         }\n         if (resto != parseInt(strCpf.substring(9, 10))) {\n         msgprint(\"Voc\u00ea informou um cpf inv\u00e1lido - mensagem 2\");\n         validated = false;\n                 }\n         soma = 0;\n         for (i = 1; i <= 10; i++) {\n             soma = soma + parseInt(strCpf.substring(i - 1, i)) * (12 - i);\n         }\n         resto = soma % 11;\n         if (resto == 10 || resto == 11 || resto < 2) {\n             resto = 0;\n         } else {\n             resto = 11 - resto;\n                      }\n         if (resto != parseInt(strCpf.substring(10, 11))) {\n             msgprint(strCpf, \"CPF Invalido\");\n             validated = false;\n         }else{\n             validated = true;\n             strCpf =strCpf.substring(0,3).concat(\".\",strCpf.substring(3,6),\".\",strCpf.substring(6,9),\"-\",strCpf.substring(9,11));\n             frm.doc.tax_id = strCpf;\n             frm.doc.customer_type = \"Individual\";\n         }\n      }\n      }\n      else if ( valida === 'CNPJ' ) {\n             var cnpj = valor;\n             var valida = new Array(6,5,4,3,2,9,8,7,6,5,4,3,2);\n             var dig1= new Number;\n             var dig2= new Number;\n             exp = /\\.|\\-|\\//g\n             cnpj = cnpj.toString().replace( exp, \"\" ); \n             var digito = new Number(eval(cnpj.charAt(12)+cnpj.charAt(13)));\n\n             for(i = 0; i<valida.length; i++){\n                dig1 += (i>0? (cnpj.charAt(i-1)*valida[i]):0);  \n                dig2 += cnpj.charAt(i)*valida[i];       \n             }\n             dig1 = (((dig1%11)<2)? 0:(11-(dig1%11)));\n             dig2 = (((dig2%11)<2)? 0:(11-(dig2%11)));\n\n             if(((dig1*10)+dig2) != digito){\n                msgprint(cnpj, \"CNPJ Invalido\");\n                validated = false; \n             }else{\n                validated = true;\n//                cnpj =cnpj.substring(0,2).concat(\".\",cnpj.substring(2,5),\".\",cnpj.substring(5,8),\"/\",cnpj.substring(8,12),\"-\",cnpj.substring(12,14));\n             frm.doc.tax_id = cnpj;\n             frm.doc.customer_type = \"Company\";\n             }\n      }\n       else{\n          msgprint(valor, \"CPF ou CNPJ Invalido\");\n          validated = false;\n      }\n    }\n});\nfrappe.ui.form.on(\"Customer\", \"refresh\", function(frm){\n\tconsole.log(frm.doc);\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Supplier", 
  "modified": "2017-09-25 14:31:03.027601", 
  "name": "Supplier-Client", 
  "script": "frappe.ui.form.on(\"Supplier\", {\n    validate: function(frm) {\n\n      var valida = '';\n\n      // Garante que o valor \u00e9 uma string\n      valor = frm.doc.tax_id.toString();\n\n      // Remove caracteres inv\u00e1lidos do valor\n      valor = valor.replace(/[^0-9]/g, '');\n\n      // Verifica CPF\n      if ( valor.length === 11 ) {\n         valida = 'CPF';\n      } \n  \n      // Verifica CNPJ\n      else if ( valor.length === 14 ) {\n         valida = 'CNPJ';\n      } \n     \n      if ( valida === 'CPF' ) {\n         var strCpf = valor;\n         var soma;\n         var resto;\n         soma = 0;\n         if (strCpf == \"00000000000\" ||\n             strCpf == \"11111111111\")\n                       {\n                       msgprint(strCpf, \"CPF invalido\");\n                       validated = false;\n                       }\n         else {\n         for (i = 1; i <= 9; i++) {\n             soma = soma + parseInt(strCpf.substring(i - 1, i)) * (11 - i);\n             }\n         resto = soma % 11;\n       \n         if (resto == 10 || resto == 11 || resto < 2) {\n             resto = 0;\n         } else {\n             resto = 11 - resto;\n         }\n         if (resto != parseInt(strCpf.substring(9, 10))) {\n         msgprint(\"Voc\u00ea informou um cpf inv\u00e1lido - mensagem 2\");\n         validated = false;\n                 }\n         soma = 0;\n         for (i = 1; i <= 10; i++) {\n             soma = soma + parseInt(strCpf.substring(i - 1, i)) * (12 - i);\n         }\n         resto = soma % 11;\n         if (resto == 10 || resto == 11 || resto < 2) {\n             resto = 0;\n         } else {\n             resto = 11 - resto;\n                      }\n         if (resto != parseInt(strCpf.substring(10, 11))) {\n             msgprint(strCpf, \"CPF Invalido\");\n             validated = false;\n         }else{\n             validated = true;\n             strCpf =strCpf.substring(0,3).concat(\".\",strCpf.substring(3,6),\".\",strCpf.substring(6,9),\"-\",strCpf.substring(9,11));\n             frm.doc.tax_id = strCpf;\n             frm.doc.customer_type = \"Individual\";\n         }\n      }\n      }\n      else if ( valida === 'CNPJ' ) {\n             var cnpj = valor;\n             var valida = new Array(6,5,4,3,2,9,8,7,6,5,4,3,2);\n             var dig1= new Number;\n             var dig2= new Number;\n             exp = /\\.|\\-|\\//g\n             cnpj = cnpj.toString().replace( exp, \"\" ); \n             var digito = new Number(eval(cnpj.charAt(12)+cnpj.charAt(13)));\n\n             for(i = 0; i<valida.length; i++){\n                dig1 += (i>0? (cnpj.charAt(i-1)*valida[i]):0);  \n                dig2 += cnpj.charAt(i)*valida[i];       \n             }\n             dig1 = (((dig1%11)<2)? 0:(11-(dig1%11)));\n             dig2 = (((dig2%11)<2)? 0:(11-(dig2%11)));\n\n             if(((dig1*10)+dig2) != digito){\n                msgprint(cnpj, \"CNPJ Invalido\");\n                validated = false; \n             }else{\n                validated = true;\n             frm.doc.tax_id = cnpj;\n             frm.doc.customer_type = \"Company\";\n             }\n      }\n       else{\n          msgprint(valor, \"CPF ou CNPJ Invalido\");\n          validated = false;\n      }\n    }\n});\nfrappe.ui.form.on(\"Supplier\", \"refresh\", function(frm){\n\tconsole.log(frm.doc)\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Invoice", 
  "modified": "2018-04-12 20:29:44.279262", 
  "name": "Purchase Invoice-Client", 
  "script": "frappe.ui.form.on(\"Purchase Invoice\", \"before_save\", function(frm) {\n\t// Para cada linha de impostos\n\t$.each(frm.doc.taxes || [], function(i, d) {\n      \t\t// Atualiza aliquota\n      \t\tif(d.aliquota.length == 0) { \n\t\t\td.aliquota = d.rate;\n\t\t}\n      \t\t// Se aliquota calculada diferente de rate, atualiza rate\n      \t\tvar_aliquota = d.aliquota * d.reducao_base / 100;\n      \t\tif( var_aliquota != d.rate) {\n\t\t\td.rate = var_aliquota\n\t\t};\n\t});\n});", 
  "script_type": "Client"
 }
]